let delay=(function(){let timer=0;return function(b,a){clearTimeout(timer);timer=setTimeout(b,a)}})();(function(a){a.fn.autocomplete=function(){return this.each(function(){let that=a(this);let refId=that.attr("id");let source=that.data("source");let name=that.data("name");let wrapperElt=a("<div>").addClass("autocomplete-wrapper");let clearElt=a("<i>").addClass("fas fa-times -js-clear hide");let searchElt=a("<input>").addClass("form-control").attr("type","text").attr("data-ref",refId);let resultsElt=a("<div>").addClass("autocomplete-results hide");if(that.val()){searchElt.val(name);clearElt.removeClass("hide")}clearElt.on("click",function(){that.val("").attr("data-name","");searchElt.val("");resultsElt.empty();a(this).addClass("hide")});wrapperElt.append(searchElt).append(clearElt).append(resultsElt);that.after(wrapperElt);resultsElt.on("click","li",function(){searchElt.val(a(this).text());that.val(a(this).data("id")).attr("data-name",a(this).text());resultsElt.addClass("hide");clearElt.removeClass("hide")});searchElt.on("focus",function(){if(resultsElt.find("li").length>0){resultsElt.removeClass("hide")}});searchElt.on("keyup",function(){delay(function(){a.get({url:source,dataType:"json",data:{q:searchElt.val()},success:function(c,b,d){resultsElt.empty();if(!resultsElt.hasClass("hide")){resultsElt.addClass("hide")}if(c.length===0){resultsElt.append(a("<p>").text(that.data("no-item-error")));resultsElt.removeClass("hide");return}let ulElt=a("<ul>");for(let i=0;i<c.length;i++){ulElt.append(a("<li>").text(c[i].name).attr("data-id",c[i].id))}resultsElt.append(ulElt);resultsElt.removeClass("hide")}})},250)});a(document).mouseup(function(b){if(!wrapperElt.is(b.target)&&wrapperElt.has(b.target).length===0&&!resultsElt.hasClass("hide")){resultsElt.addClass("hide")}})})}}(jQuery));